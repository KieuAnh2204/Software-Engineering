# üçÉ K·∫øt n·ªëi MongoDB Atlas v·ªõi VS Code

## ‚úÖ Extension ƒë√£ c√†i ƒë·∫∑t: MongoDB for VS Code

---

## üîó Connection String

### Your MongoDB Atlas Connection String:
```
mongodb+srv://foodfast_delivery:foodfast_delivery@cluster0.r3lhqwd.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0
```

### Credentials:
- **Username**: `foodfast_delivery`
- **Password**: `foodfast_delivery`
- **Cluster**: `cluster0.r3lhqwd.mongodb.net`

---

## üìã H∆∞·ªõng d·∫´n k·∫øt n·ªëi t·ª´ng b∆∞·ªõc

### C√°ch 1: K·∫øt n·ªëi nhanh (Recommended)

1. **M·ªü MongoDB Extension**
   - Click icon **MongoDB** ·ªü Activity Bar (thanh b√™n tr√°i)
   - Ho·∫∑c nh·∫•n `Ctrl+Shift+P` ‚Üí g√µ `MongoDB: Open Overview`

2. **Add Connection**
   - Click n√∫t **"Add Connection"** 
   - Ho·∫∑c click icon **"+"** ·ªü panel MongoDB

3. **Paste Connection String**
   ```
   mongodb+srv://foodfast_delivery:foodfast_delivery@cluster0.r3lhqwd.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0
   ```
   - Paste v√†o √¥ **"Connection String"**
   - Click **"Connect"**

4. **Th√†nh c√¥ng!**
   - B·∫°n s·∫Ω th·∫•y:
     ```
     üìÅ Cluster0
       üìÅ admin
       üìÅ foodfast_order_db
       üìÅ foodfast_payment_db
       üìÅ foodfast_product_db
       üìÅ foodfast_user_db
       üìÅ local
     ```

---

### C√°ch 2: K·∫øt n·ªëi th·ªß c√¥ng (Advanced)

1. **M·ªü MongoDB Extension**
   - Click icon MongoDB ·ªü Activity Bar

2. **Click "Add Connection"**

3. **Ch·ªçn "Advanced Connection Settings"**

4. **ƒêi·ªÅn th√¥ng tin:**
   - **Connection String Scheme**: `mongodb+srv://`
   - **Host**: `cluster0.r3lhqwd.mongodb.net`
   - **Authentication**: Username/Password
   - **Username**: `foodfast_delivery`
   - **Password**: `foodfast_delivery`
   - **Authentication Database**: `admin` (default)
   - **Default Database**: (leave empty or choose one)

5. **Click "Connect"**

---

## üéØ Sau khi k·∫øt n·ªëi th√†nh c√¥ng

### B·∫°n c√≥ th·ªÉ:

‚úÖ **Xem databases v√† collections**
   - Expand Cluster0 ‚Üí Expand database ‚Üí Xem collections

‚úÖ **Query d·ªØ li·ªáu**
   - Right-click collection ‚Üí "View Documents"
   - Ho·∫∑c t·∫°o file `.mongodb` ƒë·ªÉ vi·∫øt queries

‚úÖ **T·∫°o Playground**
   - `Ctrl+Shift+P` ‚Üí `MongoDB: Create MongoDB Playground`
   - Vi·∫øt MongoDB queries v·ªõi IntelliSense

‚úÖ **Export/Import data**
   - Right-click collection ‚Üí Export/Import

---

## üìä Databases trong project c·ªßa b·∫°n

### 1. foodfast_user_db
```
Collections:
- users (Customers, Restaurants & Admin profiles)
  * Customers: role='customer' with customerProfile
  * Restaurants: role='restaurant' with restaurantProfile
  * Admins: role='admin'
```

### 2. foodfast_product_db
```
Collections:
- products (Menu items linked to restaurants)
```

### 3. foodfast_order_db
```
Collections:
- orders (Order information)
```

### 4. foodfast_payment_db
```
Collections:
- payments (Payment transactions)
```

---

## üß™ Test Query v·ªõi MongoDB Playground

### T·∫°o Playground file:
1. `Ctrl+Shift+P` ‚Üí `MongoDB: Create MongoDB Playground`
2. Ch·ªçn database: `foodfast_user_db`

### Example Queries:

```javascript
// Switch to database
use('foodfast_user_db');

// Find all users
db.users.find({});

// Find all customers
db.users.find({ role: 'customer' });

// Find all restaurants
db.users.find({ role: 'restaurant' });

// Find restaurant by name
db.users.findOne({ 
  role: 'restaurant',
  'restaurantProfile.restaurantName': 'Ph·ªü 24'
});

// Count users by role
db.users.countDocuments({ role: 'customer' });
db.users.countDocuments({ role: 'restaurant' });

// Find restaurants in specific city
db.users.find({ 
  role: 'restaurant',
  'restaurantProfile.address.city': 'H·ªì Ch√≠ Minh'
});

// Find restaurants by cuisine type
db.users.find({
  role: 'restaurant',
  'restaurantProfile.cuisineType': 'Vietnamese'
});

// Find restaurants accepting orders
db.users.find({
  role: 'restaurant',
  'restaurantProfile.isAcceptingOrders': true
});
```

### Run Query:
- Click **"Play"** button (‚ñ∂) ·ªü g√≥c ph·∫£i tr√™n
- Ho·∫∑c nh·∫•n `Ctrl+Alt+R`

---

## üîç View Your Test Data

### Query to see a customer:
```javascript
use('foodfast_user_db');

db.users.findOne({ username: 'customer1' });
```

**Expected Result (Customer):**
```json
{
  "_id": ObjectId("..."),
  "username": "customer1",
  "email": "customer1@foodfast.com",
  "fullName": "Nguy·ªÖn VƒÉn A",
  "phone": "+84901234567",
  "password": "$2a$10$...",
  "role": "customer",
  "isActive": true,
  "customerProfile": {
    "address": {
      "street": "123 L√™ L·ª£i",
      "ward": "Ph∆∞·ªùng B·∫øn Ngh√©",
      "district": "Qu·∫≠n 1",
      "city": "H·ªì Ch√≠ Minh"
    },
    "favoriteRestaurants": [],
    "orderHistory": []
  },
  "createdAt": "2025-10-18T...",
  "updatedAt": "2025-10-18T..."
}
```

### Query to see a restaurant:
```javascript
use('foodfast_user_db');

db.users.findOne({ username: 'restaurant_pho24' });
```

**Expected Result (Restaurant):**
```json
{
  "_id": ObjectId("..."),
  "username": "restaurant_pho24",
  "email": "pho24@restaurant.com",
  "fullName": "Ph·ªü 24 Manager",
  "phone": "+84902345678",
  "password": "$2a$10$...",
  "role": "restaurant",
  "isActive": true,
  "restaurantProfile": {
    "restaurantName": "Ph·ªü 24",
    "description": "Ph·ªü truy·ªÅn th·ªëng Vi·ªát Nam",
    "cuisineType": ["Vietnamese"],
    "address": {
      "street": "456 Nguy·ªÖn Hu·ªá",
      "ward": "Ph∆∞·ªùng B·∫øn Ngh√©",
      "district": "Qu·∫≠n 1",
      "city": "H·ªì Ch√≠ Minh"
    },
    "openingHours": {
      "monday": { "open": "06:00", "close": "22:00", "isClosed": false },
      // ... other days
    },
    "rating": {
      "average": 0,
      "count": 0
    },
    "priceRange": "$$",
    "isVerified": false,
    "isAcceptingOrders": true,
    "deliveryFee": 15000,
    "minOrderAmount": 50000,
    "images": [],
    "logo": ""
  },
  "createdAt": "2025-10-18T...",
  "updatedAt": "2025-10-18T..."
}
```

---

## üé® Useful MongoDB Queries

### User Service Queries:

```javascript
use('foodfast_user_db');

// 1. Count users by role
db.users.aggregate([
  { $group: { _id: "$role", count: { $sum: 1 } } }
]);

// 2. Find recently registered users
db.users.find({}).sort({ createdAt: -1 }).limit(5);

// 3. Find active customers
db.users.find({ 
  role: 'customer',
  isActive: true 
});

// 4. Find restaurants accepting orders
db.users.find({
  role: 'restaurant',
  'restaurantProfile.isAcceptingOrders': true
});

// 5. Update customer address
db.users.updateOne(
  { username: 'customer1' },
  { 
    $set: { 
      'customerProfile.address.street': '789 Hai B√† Tr∆∞ng',
      'customerProfile.address.city': 'H·ªì Ch√≠ Minh'
    } 
  }
);

// 6. Update restaurant info
db.users.updateOne(
  { username: 'restaurant_pho24' },
  { 
    $set: { 
      'restaurantProfile.deliveryFee': 20000,
      'restaurantProfile.minOrderAmount': 80000
    } 
  }
);

// 7. Find restaurants by cuisine and city
db.users.find({
  role: 'restaurant',
  'restaurantProfile.cuisineType': 'Vietnamese',
  'restaurantProfile.address.city': 'H·ªì Ch√≠ Minh'
});

// 8. Find restaurants with rating >= 4.0
db.users.find({
  role: 'restaurant',
  'restaurantProfile.rating.average': { $gte: 4.0 }
});

// 9. Find customers with orders history
db.users.find({
  role: 'customer',
  'customerProfile.orderHistory': { $ne: [] }
});

// 10. Count restaurants by cuisine type
db.users.aggregate([
  { $match: { role: 'restaurant' } },
  { $unwind: '$restaurantProfile.cuisineType' },
  { 
    $group: { 
      _id: '$restaurantProfile.cuisineType', 
      count: { $sum: 1 } 
    } 
  },
  { $sort: { count: -1 } }
]);

// 11. Find restaurants in District 1, Ho Chi Minh City
db.users.find({
  role: 'restaurant',
  'restaurantProfile.address.district': 'Qu·∫≠n 1',
  'restaurantProfile.address.city': 'H·ªì Ch√≠ Minh'
});

// 12. Update restaurant to stop accepting orders
db.users.updateOne(
  { username: 'restaurant_pho24' },
  { 
    $set: { 
      'restaurantProfile.isAcceptingOrders': false 
    } 
  }
);

// 13. Add favorite restaurant for customer
db.users.updateOne(
  { username: 'customer1' },
  { 
    $push: { 
      'customerProfile.favoriteRestaurants': ObjectId('restaurant_id_here')
    } 
  }
);

// 14. Find all verified restaurants
db.users.find({
  role: 'restaurant',
  'restaurantProfile.isVerified': true
});

// 15. Search restaurants by name (case-insensitive)
db.users.find({
  role: 'restaurant',
  'restaurantProfile.restaurantName': { 
    $regex: 'ph·ªü', 
    $options: 'i' 
  }
});
```

### Product Service Queries:

```javascript
use('foodfast_product_db');

// View all products
db.products.find({});

// Find products by restaurant
db.products.find({ restaurantId: 'restaurant_id_here' });

// Find available products
db.products.find({ isAvailable: true });

// Products in price range
db.products.find({ 
  price: { $gte: 50000, $lte: 200000 } 
});
```

### Order Service Queries:

```javascript
use('foodfast_order_db');

// View all orders
db.orders.find({});

// Find orders by user
db.orders.find({ userId: 'user_id_here' });

// Find orders by status
db.orders.find({ status: 'pending' });

// Count orders by status
db.orders.aggregate([
  { $group: { _id: "$status", count: { $sum: 1 } } }
]);
```

### Payment Service Queries:

```javascript
use('foodfast_payment_db');

// View all payments
db.payments.find({});

// Find successful payments
db.payments.find({ status: 'completed' });

// Total revenue
db.payments.aggregate([
  { $match: { status: 'completed' } },
  { $group: { _id: null, total: { $sum: "$amount" } } }
]);
```

---

## üõ†Ô∏è MongoDB Extension Features

### 1. **IntelliSense**
   - Auto-complete database names
   - Auto-complete collection names
   - Auto-complete field names

### 2. **Syntax Highlighting**
   - MongoDB queries highlighted
   - JSON formatting

### 3. **Export Results**
   - Export to JSON
   - Export to CSV

### 4. **Connection Management**
   - Save multiple connections
   - Switch between connections
   - Connection favorites

### 5. **Debugging**
   - View query execution time
   - View query results
   - Error messages with line numbers

---

## üîí Security Notes

### ‚ö†Ô∏è Current Setup:
- IP Whitelist: `0.0.0.0/0` (Allow from anywhere)
- **This is OK for development**
- **NOT recommended for production**

### üõ°Ô∏è Production Recommendations:
1. Restrict IP whitelist to specific IPs
2. Use stronger passwords
3. Enable 2FA on MongoDB Atlas
4. Rotate credentials regularly
5. Use separate users for read/write access

---

## üéØ Quick Commands

### Open MongoDB Panel:
```
Ctrl+Shift+P ‚Üí MongoDB: Open Overview
```

### Create Playground:
```
Ctrl+Shift+P ‚Üí MongoDB: Create MongoDB Playground
```

### Run Playground:
```
Ctrl+Alt+R (in .mongodb file)
```

### Refresh Connections:
```
Right-click connection ‚Üí Refresh
```

### Disconnect:
```
Right-click connection ‚Üí Disconnect
```

---

## üìö Useful Resources

- **MongoDB for VS Code Docs**: https://www.mongodb.com/docs/mongodb-vscode/
- **MongoDB Query Language**: https://www.mongodb.com/docs/manual/tutorial/query-documents/
- **MongoDB Atlas Docs**: https://www.mongodb.com/docs/atlas/

---

## ‚úÖ Connection Test Checklist

- [ ] MongoDB Extension installed
- [ ] Connection string added
- [ ] Successfully connected to Cluster0
- [ ] Can see all 4 databases (user, product, order, payment)
- [ ] Can view users collection in foodfast_user_db
- [ ] Can see customers (role='customer')
- [ ] Can see restaurants (role='restaurant')
- [ ] Created MongoDB Playground
- [ ] Ran test queries successfully
- [ ] Can query customerProfile and restaurantProfile

---

## üéä Th√†nh c√¥ng!

**B·∫°n ƒë√£ k·∫øt n·ªëi MongoDB Atlas v·ªõi VS Code!**

B√¢y gi·ªù b·∫°n c√≥ th·ªÉ:
- ‚úÖ View v√† query d·ªØ li·ªáu tr·ª±c ti·∫øp t·ª´ VS Code
- ‚úÖ Kh√¥ng c·∫ßn m·ªü MongoDB Compass hay Atlas Web UI
- ‚úÖ Vi·∫øt queries v·ªõi IntelliSense
- ‚úÖ Debug v√† test nhanh h∆°n

---

## üÜò Troubleshooting

### ‚ùå "Authentication failed"
- Check username/password
- Make sure credentials match: `foodfast_delivery` / `foodfast_delivery`

### ‚ùå "Connection timeout"
- Check internet connection
- Check IP whitelist in MongoDB Atlas (should be 0.0.0.0/0)

### ‚ùå "Cannot find database"
- Make sure services have created databases
- Run `docker-compose up -d` to start services
- Wait for services to connect to MongoDB

### ‚ùå "Extension not working"
- Reload VS Code window: `Ctrl+Shift+P` ‚Üí `Reload Window`
- Reinstall extension: `Ctrl+Shift+X` ‚Üí Search "MongoDB" ‚Üí Reinstall

---

**Need help? Ask me! üöÄ**
